<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HymnLok Middle School Hard Mode</title>
    <style>
        :root { --math: #3b82f6; --ela: #a855f7; --sci: #10b981; --soc: #e74c3c; }
        body { font-family: 'Inter', sans-serif; background: #0f172a; color: #f1f5f9; display: flex; justify-content: center; padding: 20px; }
        #app { background: #1e293b; width: 100%; max-width: 600px; padding: 40px; border-radius: 24px; border: 1px solid #334155; box-shadow: 0 25px 50px -12px rgba(0,0,0,0.5); }
        .hidden { display: none !important; }
        .visual-box { background: #0f172a; border: 1px solid #334155; border-radius: 16px; padding: 25px; margin: 20px 0; text-align: center; font-size: 60px; }
        .btn { display: block; width: 100%; padding: 18px; margin: 10px 0; border: 1px solid #334155; border-radius: 12px; cursor: pointer; background: #1e293b; text-align: left; font-size: 16px; color: #cbd5e1; transition: 0.2s; border: 1px solid #334155; }
        .btn:hover { background: #334155; border-color: #3b82f6; color: #fff; transform: translateX(5px); }
        .sub-btn { color: white; border: none; text-align: center; font-size: 18px; font-weight: 700; }
        #progress-bar { height: 10px; background: #0f172a; border-radius: 10px; margin-bottom: 20px; overflow: hidden; }
        #progress-fill { height: 100%; width: 0%; transition: 0.4s; }
        .grade-tag { font-size: 12px; padding: 5px 15px; background: #3b82f6; border-radius: 8px; color: #fff; font-weight: 800; transition: all 0.3s ease; }
        .dot { width: 10px; height: 10px; background: #334155; border-radius: 50%; }
        .dot.active { background: #10b981; box-shadow: 0 0 10px #10b981; }
        .downrank { background: #ef4444 !important; animation: shake 0.5s; }
        @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(5px); } 50% { transform: translateX(-5px); } }
    </style>
</head>
<body>

<div id="app">
    <div id="home">
        <h1 style="text-align:center; font-size: 50px; font-weight: 800; margin-bottom: 5px;">HymnLok</h1>
        <p style="text-align:center; color: #94a3b8; margin-bottom: 30px;">Adv. Middle School Adaptive (30 Items)</p>
        <button class="btn sub-btn" style="background:var(--math)" onclick="run('math')">üìê Advanced Math</button>
        <button class="btn sub-btn" style="background:var(--ela)" onclick="run('ela')">üìñ Advanced ELA</button>
        <button class="btn sub-btn" style="background:var(--sci)" onclick="run('science')">üß¨ General Science</button>
        <button class="btn sub-btn" style="background:var(--soc)" onclick="run('social')">üåç World History</button>
    </div>

    <div id="quiz" class="hidden">
        <div style="display:flex; justify-content:space-between; align-items: center; margin-bottom:10px;">
            <span id="q-count" style="color:#64748b; font-size: 14px; font-weight: bold;">ITEM 1 / 30</span>
            <span id="grade-level" class="grade-tag">GRADE 6</span>
        </div>
        <div style="display:flex; gap:8px; margin-bottom:10px;">
            <div class="dot" id="d1"></div><div class="dot" id="d2"></div><div class="dot" id="d3"></div>
        </div>
        <div id="progress-bar"><div id="progress-fill"></div></div>
        <div id="visual-area" class="visual-box"></div>
        <h2 id="q-text" style="font-weight: 500; min-height: 60px; font-size: 19px;"></h2>
        <div id="options"></div>
    </div>

    <div id="results" class="hidden">
        <h1 style="text-align:center;">Evaluation Over</h1>
        <div id="final-rit" style="text-align:center; font-size: 80px; font-weight: 900; color: #3b82f6;"></div>
        <p id="accuracy" style="text-align:center; color:#10b981; font-weight:800;"></p>
        <p id="feedback" style="text-align:center; font-size: 20px; font-weight: bold;"></p>
        <button class="btn" style="text-align:center; background: #f8fafc; color: #0f172a; font-weight: 800;" onclick="location.reload()">Return to Start</button>
    </div>
</div>

<script>
const items = {
    "math": [
        { q: "A jacket costs $80 but is 30% off. What is the final price?", v: "üè∑Ô∏è", a: ["$56", "$64", "$50", "$24"], c: "$56" },
        { q: "What is the volume of a cylinder with radius 2 and height 5? (Use 3.14 for œÄ)", v: "ü•´", a: ["62.8", "31.4", "20.0", "12.56"], c: "62.8" },
        { q: "Simplify the expression: 4(x + 2) - 3x", v: "‚öñÔ∏è", a: ["x + 8", "7x + 8", "x + 2", "4x + 5"], c: "x + 8" },
        { q: "Solve for x: 2x/5 = 8", v: "üî¢", a: ["20", "10", "40", "16"], c: "20" },
        { q: "Find the surface area of a cube with side length 3.", v: "üì¶", a: ["54", "27", "36", "9"], c: "54" },
        { q: "If a car travels 150 miles in 2.5 hours, what is its average speed?", v: "üèéÔ∏è", a: ["60 mph", "55 mph", "75 mph", "65 mph"], c: "60 mph" },
        { q: "What is the sum of the interior angles of a pentagon?", v: "üìê", a: ["540¬∞", "360¬∞", "180¬∞", "720¬∞"], c: "540¬∞" },
        { q: "Solve for n: 3(n - 4) = 15", v: "‚öñÔ∏è", a: ["9", "7", "5", "11"], c: "9" },
        { q: "Express 0.00045 in scientific notation.", v: "üî¨", a: ["4.5 x 10^-4", "4.5 x 10^-5", "45 x 10^-3", "0.45 x 10^-3"], c: "4.5 x 10^-4" },
        { q: "A bag has 3 red marbles and 7 blue. Probability of picking red?", v: "üé≤", a: ["30%", "70%", "3/7", "50%"], c: "30%" }
    ],
    "ela": [
        { q: "What is the meaning of 'adversity'?", v: "üìñ", a: ["Difficulties/Hardship", "Good luck", "Clear weather", "A type of advertisement"], c: "Difficulties/Hardship" },
        { q: "Which sentence uses an 'Oxymoron'?", v: "‚úçÔ∏è", a: ["The giant shrimp was delicious.", "He ran like the wind.", "The sun smiled down.", "I'm so hungry I could eat a horse."], c: "The giant shrimp was delicious." },
        { q: "Identify the 'Mood' of a story that uses words like 'dreary,' 'shadowy,' and 'eerie.'", v: "üé≠", a: ["Suspenseful/Gloomy", "Cheerful", "Optimistic", "Humorous"], c: "Suspenseful/Gloomy" },
        { q: "What is 'Alliteration'?", v: "üî°", a: ["Repetition of consonant sounds", "Exaggeration for effect", "Comparing two unlike things", "Words that mimic sounds"], c: "Repetition of consonant sounds" },
        { q: "What is the 'Climax' of a plot?", v: "üèîÔ∏è", a: ["The turning point of highest tension", "The beginning", "The resolution", "The falling action"], c: "The turning point of highest tension" }
    ],
    "science": [
        { q: "In a plant cell, which organelle is responsible for photosynthesis?", v: "üåø", a: ["Chloroplast", "Mitochondria", "Nucleus", "Vacuole"], c: "Chloroplast" },
        { q: "What is the main difference between an Element and a Compound?", v: "üß™", a: ["Elements are pure; Compounds are mixed", "Elements are liquids; Compounds are solids", "Compounds are pure; Elements are mixed", "There is no difference"], c: "Elements are pure; Compounds are mixed" },
        { q: "Which layer of the Earth is responsible for the magnetic field?", v: "üåç", a: ["Outer Core", "Crust", "Upper Mantle", "Inner Core"], c: "Outer Core" },
        { q: "What type of energy is stored in a battery?", v: "üîã", a: ["Chemical Potential", "Kinetic", "Thermal", "Nuclear"], c: "Chemical Potential" },
        { q: "What is the density of an object with mass 20g and volume 5cm¬≥?", v: "‚öñÔ∏è", a: ["4 g/cm¬≥", "100 g/cm¬≥", "0.25 g/cm¬≥", "15 g/cm¬≥"], c: "4 g/cm¬≥" }
    ],
    "social": [
        { q: "What was the main cause of the Black Death in the 14th century?", v: "üêÄ", a: ["Bacteria on fleas", "Bad air", "Lack of exercise", "Volcanic eruptions"], c: "Bacteria on fleas" },
        { q: "The 'Silk Road' was primarily used for:", v: "üê™", a: ["Trade between Europe and Asia", "A marathon route", "Religious pilgrimages only", "Military invasions of Africa"], c: "Trade between Europe and Asia" },
        { q: "Which ancient civilization created the first democracy?", v: "üèõÔ∏è", a: ["Greece", "Rome", "Egypt", "Mesopotamia"], c: "Greece" },
        { q: "What is the purpose of the 'Checks and Balances' system in government?", v: "‚öñÔ∏è", a: ["Prevent one branch from being too powerful", "Count the money in the treasury", "Balance the number of states", "Control the weather"], c: "Prevent one branch from being too powerful" }
    ]
};

const grades = ["GRADE 6 (ADV)", "GRADE 7 (ADV)", "GRADE 8 (ADV)"];
let state = { sub: "", idx: 0, rit: 218, seen: [], streak: 0, gradeIdx: 0, correct: 0 };

function run(s) {
    state = { sub: s, idx: 0, rit: 218, seen: [], streak: 0, gradeIdx: 0, correct: 0 };
    document.getElementById('home').classList.add('hidden');
    document.getElementById('quiz').classList.remove('hidden');
    document.getElementById('progress-fill').style.background = `var(--${s})`;
    render();
}

function render() {
    if (state.idx >= 30) return finish();
    if (state.streak >= 3) { state.streak = 0; if (state.gradeIdx < 2) state.gradeIdx++; }

    let pool = items[state.sub].filter(q => !state.seen.includes(q.q));
    if (pool.length === 0) { state.seen = []; pool = items[state.sub]; }
    
    let q = pool[Math.floor(Math.random() * pool.length)];
    state.seen.push(q.q);
    
    document.getElementById('q-count').innerText = `ITEM ${state.idx + 1} / 30`;
    let tag = document.getElementById('grade-level');
    tag.innerText = grades[state.gradeIdx];
    tag.classList.remove('downrank');
    
    document.getElementById('progress-fill').style.width = `${(state.idx / 30) * 100}%`;
    document.getElementById('visual-area').innerText = q.v;
    document.getElementById('q-text').innerText = q.q;

    for(let i=1; i<=3; i++) { 
        document.getElementById(`d${i}`).className = i <= state.streak ? "dot active" : "dot"; 
    }

    let box = document.getElementById('options');
    box.innerHTML = "";
    [...q.a].sort(() => Math.random() - 0.5).forEach(opt => {
        let b = document.createElement('button');
        b.className = "btn";
        b.innerText = opt;
        b.onclick = () => {
            if(opt === q.c) { state.rit += 4; state.streak++; state.correct++; } 
            else { 
                if (state.streak === 0 && state.gradeIdx > 0) {
                    state.gradeIdx--;
                    document.getElementById('grade-level').classList.add('downrank');
                }
                state.rit = Math.max(170, state.rit - 4); 
                state.streak = 0; 
            }
            state.idx++; render();
        };
        box.appendChild(b);
    });
}

function finish() {
    document.getElementById('quiz').classList.add('hidden');
    document.getElementById('results').classList.remove('hidden');
    document.getElementById('final-rit').innerText = state.rit;
    document.getElementById('accuracy').innerText = `Mastery: ${state.correct} / 30`;
    document.getElementById('feedback').innerText = `Final Level: ${grades[state.gradeIdx]}`;
}
</script>
</body>
</html>