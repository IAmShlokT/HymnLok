<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HymnLok Balanced</title>
    <style>
        :root { --math: #3b82f6; --ela: #a855f7; --sci: #10b981; --soc: #e74c3c; }
        body { font-family: 'Inter', sans-serif; background: #0f172a; color: #f1f5f9; display: flex; justify-content: center; padding: 20px; }
        #app { background: #1e293b; width: 100%; max-width: 600px; padding: 40px; border-radius: 24px; border: 1px solid #334155; box-shadow: 0 25px 50px -12px rgba(0,0,0,0.5); }
        .hidden { display: none !important; }
        .visual-box { background: #0f172a; border: 1px solid #334155; border-radius: 16px; padding: 25px; margin: 20px 0; text-align: center; font-size: 60px; }
        .btn { display: block; width: 100%; padding: 18px; margin: 10px 0; border: 1px solid #334155; border-radius: 12px; cursor: pointer; background: #1e293b; text-align: left; font-size: 16px; color: #cbd5e1; transition: 0.2s; }
        .btn:hover { background: #334155; border-color: #3b82f6; color: #fff; transform: translateX(5px); }
        .sub-btn { color: white; border: none; text-align: center; font-size: 18px; font-weight: 700; }
        #progress-bar { height: 10px; background: #0f172a; border-radius: 10px; margin-bottom: 20px; overflow: hidden; }
        #progress-fill { height: 100%; width: 0%; transition: 0.4s; }
        .grade-tag { font-size: 12px; padding: 5px 15px; background: #3b82f6; border-radius: 8px; color: #fff; font-weight: 800; }
        .dot { width: 10px; height: 10px; background: #334155; border-radius: 50%; }
        .dot.active { background: #10b981; box-shadow: 0 0 10px #10b981; }
        .downrank { background: #ef4444 !important; animation: shake 0.5s; }
        @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(5px); } 50% { transform: translateX(-5px); } }
    </style>
</head>
<body>

<div id="app">
    <div id="home">
        <h1 style="text-align:center; font-size: 50px; font-weight: 800;">HymnLok</h1>
        <p style="text-align:center; color: #94a3b8; margin-bottom: 30px;">Balanced Adaptive Challenge</p>
        <button class="btn sub-btn" style="background:var(--math)" onclick="run('math')">üìê Mathematics</button>
        <button class="btn sub-btn" style="background:var(--ela)" onclick="run('ela')">üìñ Language Arts</button>
        <button class="btn sub-btn" style="background:var(--sci)" onclick="run('science')">üß¨ Science</button>
        <button class="btn sub-btn" style="background:var(--soc)" onclick="run('social')">üåç Social Studies</button>
    </div>

    <div id="quiz" class="hidden">
        <div style="display:flex; justify-content:space-between; align-items: center; margin-bottom:10px;">
            <span id="q-count" style="color:#64748b; font-size: 14px; font-weight: bold;">ITEM 1 / 30</span>
            <span id="grade-level" class="grade-tag">GRADE 6</span>
        </div>
        <div style="display:flex; gap:8px; margin-bottom:10px;"><div class="dot" id="d1"></div><div class="dot" id="d2"></div><div class="dot" id="d3"></div></div>
        <div id="progress-bar"><div id="progress-fill"></div></div>
        <div id="visual-area" class="visual-box"></div>
        <h2 id="q-text" style="font-weight: 500;"></h2>
        <div id="options"></div>
    </div>

    <div id="results" class="hidden">
        <h1 style="text-align:center;">Session Complete</h1>
        <div id="final-rit" style="text-align:center; font-size: 80px; font-weight: 900; color: #3b82f6;"></div>
        <p id="accuracy" style="text-align:center; color:#10b981; font-weight:800;"></p>
        <p id="feedback" style="text-align:center; font-size: 20px; font-weight: bold;"></p>
        <button class="btn" style="text-align:center; background: #f8fafc; color: #0f172a; font-weight: 800;" onclick="location.reload()">Return to Menu</button>
    </div>
</div>

<script>
const items = {
    "math": [
        { q: "Solve for x: 3x + 4 = 19", v: "‚öñÔ∏è", a: ["5", "6", "15", "7"], c: "5" },
        { q: "What is the area of a circle with a radius of 4? (Use œÄ = 3.14)", v: "‚≠ï", a: ["50.24", "12.56", "25.12", "16.0"], c: "50.24" },
        { q: "Find 25% of 120.", v: "üî¢", a: ["30", "25", "40", "60"], c: "30" },
        { q: "Evaluate: 2¬≥ + 5 √ó 2", v: "üî¢", a: ["18", "26", "16", "30"], c: "18" },
        { q: "What is the surface area of a cube with side 2?", v: "üì¶", a: ["24", "8", "16", "12"], c: "24" },
        { q: "A car goes 240 miles in 4 hours. What is its speed?", v: "üöó", a: ["60 mph", "50 mph", "70 mph", "65 mph"], c: "60 mph" },
        { q: "Simplify the fraction 24/36.", v: "üçï", a: ["2/3", "3/4", "1/2", "5/6"], c: "2/3" },
        { q: "Solve for y: y/3 - 2 = 5", v: "‚öñÔ∏è", a: ["21", "15", "9", "18"], c: "21" },
        { q: "A triangle has angles of 45¬∞ and 90¬∞. What is the third angle?", v: "üìê", a: ["45¬∞", "60¬∞", "90¬∞", "30¬∞"], c: "45¬∞" },
        { q: "What is 0.08 expressed as a percentage?", v: "üî¢", a: ["8%", "0.8%", "80%", "0.08%"], c: "8%" }
    ],
    "ela": [
        { q: "Which word is a synonym for 'Prosper'?", v: "üìà", a: ["Thrive", "Fail", "Begin", "Wait"], c: "Thrive" },
        { q: "What is the 'Setting' of a story?", v: "üèîÔ∏è", a: ["Time and Place", "Main Character", "The Problem", "The Ending"], c: "Time and Place" },
        { q: "Identify the metaphor:", v: "üìñ", a: ["Time is a thief.", "He ran like a cheetah.", "The cat meowed.", "A big blue bird."], c: "Time is a thief." },
        { q: "Which word is an interjection?", v: "üóØÔ∏è", a: ["Ouch!", "Running", "Beautiful", "Between"], c: "Ouch!" },
        { q: "What is the 'Point of View' when the narrator uses 'I' and 'Me'?", v: "üë§", a: ["First Person", "Third Person", "Second Person", "Omniscient"], c: "First Person" }
    ],
    "science": [
        { q: "Which planet is known as the 'Gas Giant' and has a Great Red Spot?", v: "ü™ê", a: ["Jupiter", "Saturn", "Neptune", "Mars"], c: "Jupiter" },
        { q: "What is the process where plants release water vapor into the air?", v: "üçÉ", a: ["Transpiration", "Evaporation", "Photosynthesis", "Respiration"], c: "Transpiration" },
        { q: "Which part of the atom has a negative charge?", v: "‚öõÔ∏è", a: ["Electron", "Proton", "Neutron", "Nucleus"], c: "Electron" },
        { q: "What kind of rock is formed from cooled magma/lava?", v: "üåã", a: ["Igneous", "Sedimentary", "Metamorphic", "Fossil"], c: "Igneous" },
        { q: "Which organ system is responsible for transporting oxygen through the body?", v: "ü´Ä", a: ["Circulatory", "Respiratory", "Nervous", "Digestive"], c: "Circulatory" }
    ],
    "social": [
        { q: "Which document starts with 'We the People'?", v: "üìú", a: ["The Constitution", "Declaration of Independence", "The Bill of Rights", "Common Sense"], c: "The Constitution" },
        { q: "The Renaissance began in which country?", v: "üé®", a: ["Italy", "France", "England", "Spain"], c: "Italy" },
        { q: "What are the three branches of the US Government?", v: "‚öñÔ∏è", a: ["Leg, Exec, Jud", "State, Fed, Local", "Pres, Cong, Mayor", "Army, Navy, Air"], c: "Leg, Exec, Jud" },
        { q: "Which continent is also a country?", v: "üåè", a: ["Australia", "Antarctica", "Africa", "Europe"], c: "Australia" },
        { q: "What was the main route for westward expansion in the 1800s?", v: "üõ§Ô∏è", a: ["Oregon Trail", "Silk Road", "Route 66", "The Appalachian Path"], c: "Oregon Trail" }
    ]
};

const grades = ["GRADE 6", "GRADE 7", "GRADE 8"];
let state = { sub: "", idx: 0, rit: 216, seen: [], streak: 0, gradeIdx: 0, correct: 0 };

function run(s) {
    state = { sub: s, idx: 0, rit: 216, seen: [], streak: 0, gradeIdx: 0, correct: 0 };
    document.getElementById('home').classList.add('hidden');
    document.getElementById('quiz').classList.remove('hidden');
    document.getElementById('progress-fill').style.background = `var(--${s})`;
    render();
}

function render() {
    if (state.idx >= 30) return finish();
    if (state.streak >= 3) { state.streak = 0; if (state.gradeIdx < 2) state.gradeIdx++; }

    let pool = items[state.sub].filter(q => !state.seen.includes(q.q));
    if (pool.length === 0) { state.seen = []; pool = items[state.sub]; }
    
    let q = pool[Math.floor(Math.random() * pool.length)];
    state.seen.push(q.q);
    
    document.getElementById('q-count').innerText = `ITEM ${state.idx + 1} / 30`;
    let tag = document.getElementById('grade-level');
    tag.innerText = grades[state.gradeIdx];
    tag.classList.remove('downrank');
    
    document.getElementById('progress-fill').style.width = `${(state.idx / 30) * 100}%`;
    document.getElementById('visual-area').innerText = q.v;
    document.getElementById('q-text').innerText = q.q;

    for(let i=1; i<=3; i++) { 
        document.getElementById(`d${i}`).className = i <= state.streak ? "dot active" : "dot"; 
    }

    let box = document.getElementById('options');
    box.innerHTML = "";
    [...q.a].sort(() => Math.random() - 0.5).forEach(opt => {
        let b = document.createElement('button');
        b.className = "btn";
        b.innerText = opt;
        b.onclick = () => {
            if(opt === q.c) { state.rit += 4; state.streak++; state.correct++; } 
            else { 
                if (state.streak === 0 && state.gradeIdx > 0) {
                    state.gradeIdx--;
                    document.getElementById('grade-level').classList.add('downrank');
                }
                state.rit = Math.max(170, state.rit - 4); 
                state.streak = 0; 
            }
            state.idx++; render();
        };
        box.appendChild(b);
    });
}

function finish() {
    document.getElementById('quiz').classList.add('hidden');
    document.getElementById('results').classList.remove('hidden');
    document.getElementById('final-rit').innerText = state.rit;
    document.getElementById('accuracy').innerText = `Score: ${state.correct} / 30`;
    document.getElementById('feedback').innerText = `Certified: ${grades[state.gradeIdx]}`;
}
</script>
</body>
</html>