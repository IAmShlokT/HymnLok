<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HymnLok Adaptive</title>
    <style>
        :root { --math: #3b82f6; --ela: #a855f7; --sci: #10b981; --soc: #e74c3c; }
        body { font-family: 'Inter', sans-serif; background: #0f172a; color: #f1f5f9; display: flex; justify-content: center; padding: 20px; }
        #app { background: #1e293b; width: 100%; max-width: 600px; padding: 40px; border-radius: 24px; border: 1px solid #334155; box-shadow: 0 25px 50px -12px rgba(0,0,0,0.5); }
        .hidden { display: none !important; }
        .visual-box { background: #0f172a; border: 1px solid #334155; border-radius: 16px; padding: 25px; margin: 20px 0; text-align: center; font-size: 60px; }
        .btn { display: block; width: 100%; padding: 18px; margin: 10px 0; border: 1px solid #334155; border-radius: 12px; cursor: pointer; background: #1e293b; text-align: left; font-size: 16px; color: #cbd5e1; transition: 0.2s; }
        .btn:hover { background: #334155; border-color: #3b82f6; color: #fff; transform: translateX(5px); }
        .sub-btn { color: white; border: none; text-align: center; font-size: 18px; font-weight: 700; }
        #progress-bar { height: 8px; background: #0f172a; border-radius: 10px; margin-bottom: 20px; overflow: hidden; }
        #progress-fill { height: 100%; width: 0%; transition: 0.4s; }
        .grade-tag { font-size: 12px; padding: 5px 15px; background: #3b82f6; border-radius: 8px; color: #fff; font-weight: 800; transition: 0.3s; }
        .dot { width: 10px; height: 10px; background: #334155; border-radius: 50%; }
        .dot.active { background: #10b981; box-shadow: 0 0 10px #10b981; }
    </style>
</head>
<body>

<div id="app">
    <div id="home">
        <h1 style="text-align:center; font-size: 50px; font-weight: 800;">HymnLok</h1>
        <p style="text-align:center; color: #94a3b8; margin-bottom: 30px;">Adaptive Grade Leveling ‚Ä¢ 30 Items</p>
        <button class="btn sub-btn" style="background:var(--math)" onclick="run('math')">üìê Mathematics</button>
        <button class="btn sub-btn" style="background:var(--ela)" onclick="run('ela')">üìñ Language Arts</button>
        <button class="btn sub-btn" style="background:var(--sci)" onclick="run('science')">üß¨ Science</button>
        <button class="btn sub-btn" style="background:var(--soc)" onclick="run('social')">üåç Social Studies</button>
    </div>

    <div id="quiz" class="hidden">
        <div style="display:flex; justify-content:space-between; align-items: center; margin-bottom:10px;">
            <span id="q-count" style="color:#64748b; font-size: 14px; font-weight: bold;">ITEM 1 / 30</span>
            <span id="grade-level" class="grade-tag">GRADE 6</span>
        </div>
        <div style="display:flex; gap:8px; margin-bottom:10px;"><div class="dot" id="d1"></div><div class="dot" id="d2"></div><div class="dot" id="d3"></div></div>
        <div id="progress-bar"><div id="progress-fill"></div></div>
        <div id="visual-area" class="visual-box"></div>
        <h2 id="q-text" style="font-weight: 500;"></h2>
        <div id="options"></div>
    </div>

    <div id="results" class="hidden">
        <h1 style="text-align:center;">Final Report</h1>
        <div id="final-rit" style="text-align:center; font-size: 80px; font-weight: 900; color: #3b82f6;"></div>
        <p id="accuracy" style="text-align:center; color:#10b981; font-weight:800;"></p>
        <p id="feedback" style="text-align:center; font-size: 20px; font-weight: bold;"></p>
        <button class="btn" style="text-align:center; background: #f8fafc; color: #0f172a; font-weight: 800;" onclick="location.reload()">Back to Menu</button>
    </div>
</div>

<script>
// Data Bank (Same massive bank from before)
const items = {
    "math": [
        { q: "What is 10% of 50?", v: "üî¢", a: ["5", "10", "1", "15"], c: "5" },
        { q: "Solve for x: x / 3 = 9", v: "‚öñÔ∏è", a: ["27", "12", "6", "3"], c: "27" },
        { q: "Simplify 15/20.", v: "üçï", a: ["3/4", "1/2", "4/5", "5/6"], c: "3/4" },
        { q: "What is the area of a triangle (Base=4, Height=5)?", v: "üìê", a: ["10", "20", "9", "40"], c: "10" },
        { q: "Evaluate: 2 + 3 * 4", v: "üî¢", a: ["14", "20", "12", "9"], c: "14" },
        { q: "Square root of 144?", v: "‚àö", a: ["12", "14", "10", "16"], c: "12" },
        { q: "Value of 2^4?", v: "üî¢", a: ["16", "8", "4", "32"], c: "16" },
        { q: "Sum of angles in a triangle?", v: "üìê", a: ["180¬∞", "360¬∞", "90¬∞", "270¬∞"], c: "180¬∞" },
        { q: "Convert 3/5 to a decimal.", v: "üî¢", a: ["0.6", "0.3", "0.5", "0.7"], c: "0.6" },
        { q: "Is 49 a perfect square?", v: "üî¢", a: ["Yes (7*7)", "No", "Only if divided", "Maybe"], c: "Yes (7*7)" },
        { q: "Degrees in a right angle?", v: "üìê", a: ["90¬∞", "45¬∞", "180¬∞", "0¬∞"], c: "90¬∞" },
        { q: "1,000 meters is how many km?", v: "üìè", a: ["1 km", "10 km", "100 km", "0.1 km"], c: "1 km" },
        { q: "What is the mode of: 2, 2, 3, 4, 5?", v: "üìä", a: ["2", "3", "4", "5"], c: "2" },
        { q: "Solve: 1/2 of 1/2", v: "üçï", a: ["1/4", "1", "1/2", "0"], c: "1/4" },
        { q: "A hexagon has how many sides?", v: "‚¨°", a: ["6", "5", "8", "10"], c: "6" }
    ],
    "ela": [
        { q: "Identify the noun: 'The moon is bright.'", v: "üåô", a: ["Moon", "Bright", "Is", "The"], c: "Moon" },
        { q: "Synonym for 'Reliable'?", v: "ü§ù", a: ["Dependable", "Fake", "Slow", "Scary"], c: "Dependable" },
        { q: "Identify the verb: 'He runs fast.'", v: "üèÉ", a: ["Runs", "Fast", "He", "Fastly"], c: "Runs" },
        { q: "A 'Stanza' is found in what?", v: "‚úçÔ∏è", a: ["Poetry", "Essay", "Letter", "Manual"], c: "Poetry" },
        { q: "Plural of 'Mouse'?", v: "üê≠", a: ["Mice", "Mouses", "Meese", "Mices"], c: "Mice" },
        { q: "Comparison using 'like' or 'as'?", v: "üìñ", a: ["Simile", "Metaphor", "Verb", "Noun"], c: "Simile" },
        { q: "The end of a story is the...?", v: "üèÅ", a: ["Resolution", "Climax", "Intro", "Conflict"], c: "Resolution" },
        { q: "Which word is an 'Adverb'?", v: "‚ú®", a: ["Quietly", "Quiet", "Silence", "Sing"], c: "Quietly" },
        { q: "Word that sounds like its meaning?", v: "üí•", a: ["Onomatopoeia", "Hyperbole", "Idiom", "Noun"], c: "Onomatopoeia" },
        { q: "Which is a 'Proper Noun'?", v: "üè∑Ô∏è", a: ["Florida", "State", "Beach", "Water"], c: "Florida" }
    ],
    "science": [
        { q: "State of matter like ice?", v: "üßä", a: ["Solid", "Liquid", "Gas", "Heat"], c: "Solid" },
        { q: "The 'Red Planet'?", v: "üî¥", a: ["Mars", "Venus", "Jupiter", "Earth"], c: "Mars" },
        { q: "Force that keeps us on the ground?", v: "üåç", a: ["Gravity", "Friction", "Wind", "Magnetism"], c: "Gravity" },
        { q: "Process of liquid turning to gas?", v: "‚ô®Ô∏è", a: ["Evaporation", "Freezing", "Melting", "Rain"], c: "Evaporation" },
        { q: "Animal with a backbone?", v: "ü¶¥", a: ["Vertebrate", "Invertebrate", "Insects", "Worm"], c: "Vertebrate" },
        { q: "Which gas do plants absorb?", v: "üåø", a: ["Carbon Dioxide", "Oxygen", "Neon", "Hydrogen"], c: "Carbon Dioxide" },
        { q: "Water boils at (Celsius)?", v: "üî•", a: ["100¬∞C", "0¬∞C", "32¬∞C", "212¬∞C"], c: "100¬∞C" },
        { q: "Powerhouse of the cell?", v: "üîã", a: ["Mitochondria", "Nucleus", "Wall", "Vacuole"], c: "Mitochondria" },
        { q: "Protects the cell?", v: "üõ°Ô∏è", a: ["Cell Membrane", "Nucleus", "Ribosome", "DNA"], c: "Cell Membrane" },
        { q: "Earth's outer layer?", v: "üåç", a: ["Crust", "Core", "Mantle", "Ocean"], c: "Crust" }
    ],
    "social": [
        { q: "Country with the Great Wall?", v: "üß±", a: ["China", "Japan", "India", "USA"], c: "China" },
        { q: "Ancient people with Pyramids?", v: "üìê", a: ["Egyptians", "Romans", "Greeks", "Aztecs"], c: "Egyptians" },
        { q: "1st President of USA?", v: "üá∫üá∏", a: ["Washington", "Jefferson", "Lincoln", "Adams"], c: "Washington" },
        { q: "Capital of France?", v: "üóº", a: ["Paris", "London", "Rome", "Berlin"], c: "Paris" },
        { q: "Largest continent?", v: "üó∫Ô∏è", a: ["Asia", "Africa", "Europe", "Antarctica"], c: "Asia" },
        { q: "Who wrote 'Declaration of Independence'?", v: "‚úçÔ∏è", a: ["Jefferson", "Washington", "Lincoln", "King"], c: "Jefferson" },
        { q: "Line at 0¬∞ latitude?", v: "üåç", a: ["Equator", "Prime Meridian", "North Pole", "Tropic"], c: "Equator" },
        { q: "How many branches of US Government?", v: "‚öñÔ∏è", a: ["3", "1", "50", "10"], c: "3" },
        { q: "Largest ocean?", v: "üåä", a: ["Pacific", "Atlantic", "Indian", "Arctic"], c: "Pacific" },
        { q: "First person on the moon?", v: "üë®‚ÄçüöÄ", a: ["Armstrong", "Aldrin", "Glenn", "Shepard"], c: "Armstrong" }
    ]
};

const grades = ["GRADE 6", "GRADE 7", "GRADE 8"];
let state = { sub: "", idx: 0, rit: 215, seen: [], streak: 0, gradeIdx: 0, correct: 0 };

function run(s) {
    state = { sub: s, idx: 0, rit: 215, seen: [], streak: 0, gradeIdx: 0, correct: 0 };
    document.getElementById('home').classList.add('hidden');
    document.getElementById('quiz').classList.remove('hidden');
    document.getElementById('progress-fill').style.background = `var(--${s})`;
    render();
}

function render() {
    if (state.idx >= 30) return finish();
    
    // Level Up: 3 in a row
    if (state.streak >= 3) { 
        state.streak = 0; 
        if (state.gradeIdx < 2) state.gradeIdx++; 
    }

    let pool = items[state.sub].filter(q => !state.seen.includes(q.q));
    if (pool.length === 0) { state.seen = []; pool = items[state.sub]; }
    
    let q = pool[Math.floor(Math.random() * pool.length)];
    state.seen.push(q.q);
    
    document.getElementById('q-count').innerText = `ITEM ${state.idx + 1} / 30`;
    document.getElementById('grade-level').innerText = grades[state.gradeIdx];
    document.getElementById('progress-fill').style.width = `${(state.idx / 30) * 100}%`;
    document.getElementById('visual-area').innerText = q.v;
    document.getElementById('q-text').innerText = q.q;

    for(let i=1; i<=3; i++) { 
        document.getElementById(`d${i}`).className = i <= state.streak ? "dot active" : "dot"; 
    }

    let box = document.getElementById('options');
    box.innerHTML = "";
    [...q.a].sort(() => Math.random() - 0.5).forEach(opt => {
        let b = document.createElement('button');
        b.className = "btn";
        b.innerText = opt;
        b.onclick = () => {
            if(opt === q.c) { 
                state.rit += 4; 
                state.streak++; 
                state.correct++; 
            } else { 
                // NEW LOGIC: Downrank if streak is 0 and above Grade 6
                if (state.streak === 0 && state.gradeIdx > 0) {
                    state.gradeIdx--;
                }
                state.rit = Math.max(160, state.rit - 3); 
                state.streak = 0; 
            }
            state.idx++; render();
        };
        box.appendChild(b);
    });
}

function finish() {
    document.getElementById('quiz').classList.add('hidden');
    document.getElementById('results').classList.remove('hidden');
    document.getElementById('final-rit').innerText = state.rit;
    document.getElementById('accuracy').innerText = `Score: ${state.correct} / 30`;
    document.getElementById('feedback').innerText = `Final Placement: ${grades[state.gradeIdx]}`;
}
</script>
</body>
</html>