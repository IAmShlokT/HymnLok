<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HymnLok STEM Tutoring Edition</title>
    <style>
        :root { --math: #3b82f6; --ela: #a855f7; --sci: #10b981; --soc: #e74c3c; }
        body { font-family: 'Inter', sans-serif; background: #0f172a; color: #f1f5f9; display: flex; justify-content: center; padding: 20px; }
        #app { background: #1e293b; width: 100%; max-width: 650px; padding: 40px; border-radius: 24px; border: 1px solid #334155; }
        .hidden { display: none !important; }
        .passage-box { background: #0f172a; border: 1px solid #a855f7; border-radius: 12px; padding: 20px; margin-bottom: 20px; font-style: italic; line-height: 1.6; font-size: 15px; color: #cbd5e1; max-height: 250px; overflow-y: auto; }
        .visual-box { background: #0f172a; border: 1px solid #334155; border-radius: 16px; padding: 25px; margin: 20px 0; text-align: center; font-size: 60px; }
        .btn { display: block; width: 100%; padding: 18px; margin: 10px 0; border: 1px solid #334155; border-radius: 12px; cursor: pointer; background: #1e293b; text-align: left; font-size: 16px; color: #cbd5e1; transition: 0.2s; }
        .btn:hover:not(:disabled) { background: #334155; border-color: #3b82f6; color: #fff; }
        .sub-btn { color: white; border: none; text-align: center; font-size: 18px; font-weight: 700; }
        #progress-bar { height: 10px; background: #0f172a; border-radius: 10px; margin-bottom: 20px; overflow: hidden; }
        #progress-fill { height: 100%; width: 0%; transition: 0.4s; }
        .grade-tag { font-size: 12px; padding: 5px 15px; background: #3b82f6; border-radius: 8px; color: #fff; font-weight: 800; }
        textarea { width: 100%; height: 120px; background: #0f172a; border: 1px solid #334155; border-radius: 12px; color: white; padding: 15px; font-family: inherit; margin-top: 10px; resize: none; border-left: 4px solid var(--ela); }
        #feedback-msg { padding: 20px; border-radius: 12px; margin: 20px 0; font-weight: 500; }
        .correct-fb { background: rgba(16, 185, 129, 0.15); color: #10b981; border: 1px solid #10b981; }
        .wrong-fb { background: rgba(231, 76, 60, 0.15); color: #e74c3c; border: 1px solid #e74c3c; }
        .explanation-text { margin-top: 10px; padding-top: 10px; border-top: 1px dashed rgba(255,255,255,0.2); font-size: 14px; color: #cbd5e1; font-style: italic; }
    </style>
</head>
<body>

<div id="app">
    <div id="home">
        <h1 style="text-align:center; font-size: 50px; font-weight: 800;">HymnLok</h1>
        <p style="text-align:center; color: #94a3b8; margin-bottom: 30px;">STEM Explanation Module | Adaptive Learning</p>
        <button class="btn sub-btn" style="background:var(--math)" onclick="startTest('math')">üìê Mathematics</button>
        <button class="btn sub-btn" style="background:var(--ela)" onclick="startTest('ela')">üìñ Language Arts</button>
        <button class="btn sub-btn" style="background:var(--sci)" onclick="startTest('science')">üß¨ Science</button>
        <button class="btn sub-btn" style="background:var(--soc)" onclick="startTest('social')">üåç Social Studies</button>
    </div>

    <div id="quiz" class="hidden">
        <div style="display:flex; justify-content:space-between; align-items: center; margin-bottom:10px;">
            <span id="q-count" style="color:#64748b; font-size: 14px; font-weight: bold;">ITEM 1 / 30</span>
            <span id="grade-level" class="grade-tag">GRADE 6</span>
        </div>
        <div id="progress-bar"><div id="progress-fill"></div></div>
        
        <div id="passage-container" class="passage-box hidden"></div>
        <div id="visual-area" class="visual-box"></div>
        <h2 id="q-text" style="font-weight: 500; font-size: 1.2rem;"></h2>
        
        <div id="input-area"></div>
        <div id="feedback-area" class="hidden">
            <div id="feedback-msg"></div>
            <button class="btn sub-btn" id="next-btn" style="background: #f1f5f9; color: #0f172a;">Continue Session ‚Üí</button>
        </div>
    </div>

    <div id="results" class="hidden">
        <h1 style="text-align:center;">Results</h1>
        <div id="final-rit" style="text-align:center; font-size: 80px; font-weight: 900; color: #3b82f6;"></div>
        <p id="accuracy" style="text-align:center; color:#10b981; font-weight:800;"></p>
        <button class="btn" style="text-align:center; background: #f8fafc; color: #0f172a; font-weight: 800;" onclick="location.reload()">Start New Session</button>
    </div>
</div>

<script>
const allData = {
    "math": [
        { q: "Solve for x: 4x - 7 = 21", v: "‚öñÔ∏è", a: ["7", "6", "8", "5"], c: "7", exp: "Add 7 to both sides (4x=28), then divide by 4 (x=7)." },
        { q: "Area of a circle with radius 3? (œÄ=3.14)", v: "‚≠ï", a: ["28.26", "18.84", "9.42", "31.4"], c: "28.26", exp: "Formula: œÄr¬≤. 3.14 * 3¬≤ = 3.14 * 9 = 28.26." },
        { q: "What is 15% of 60?", v: "üî¢", a: ["9", "6", "12", "15"], c: "9", exp: "15/100 * 60 = 0.15 * 60 = 9." },
        { q: "Volume of a box 4x3x2?", v: "üì¶", a: ["24", "12", "18", "48"], c: "24", exp: "Multiply Length * Width * Height: 4 * 3 * 2 = 24." },
        { q: "Solve: 2(x + 5) = 22", v: "‚öñÔ∏è", a: ["6", "11", "12", "8"], c: "6", exp: "Divide by 2 (x+5=11), then subtract 5 (x=6)." },
        { q: "What is the square root of 225?", v: "‚àö", a: ["15", "12", "25", "20"], c: "15", exp: "15 * 15 = 225." },
        { q: "Find the median: 3, 7, 9, 12, 15", v: "üìä", a: ["9", "7", "12", "10"], c: "9", exp: "The median is the middle value in a sorted list." },
        { q: "Value of 4 to the power of 3?", v: "üî¢", a: ["64", "16", "32", "12"], c: "64", exp: "4 * 4 * 4 = 64." },
        { q: "A triangle has base 10 and height 4. Area?", v: "üìê", a: ["20", "40", "14", "10"], c: "20", exp: "Formula: 1/2 * base * height = 1/2 * 10 * 4 = 20." },
        { q: "Next in sequence: 2, 5, 10, 17...", v: "üî¢", a: ["26", "24", "25", "19"], c: "26", exp: "The gap between numbers increases by 2 each time (+3, +5, +7, so next is +9)." },
        { q: "Write 3/8 as a decimal.", v: "üî¢", a: ["0.375", "0.38", "0.4", "0.33"], c: "0.375", exp: "Divide 3 by 8 to get 0.375." },
        { q: "Degrees in a quadrilateral?", v: "‚ñ≠", a: ["360", "180", "90", "270"], c: "360", exp: "All four-sided shapes have interior angles totaling 360¬∞." },
        { q: "Solve for y: y/4 + 6 = 10", v: "‚öñÔ∏è", a: ["16", "8", "4", "20"], c: "16", exp: "Subtract 6 (y/4 = 4), then multiply by 4 (y=16)." },
        { q: "Slope of line through (0,0) and (2,4)?", v: "üìà", a: ["2", "1/2", "4", "0"], c: "2", exp: "Slope = (y2-y1)/(x2-x1) = (4-0)/(2-0) = 2." },
        { q: "Simplest form of 42/56?", v: "üçï", a: ["3/4", "6/8", "1/2", "2/3"], c: "3/4", exp: "Divide both by their Greatest Common Factor (14): 42/14=3, 56/14=4." },
        { q: "Absolute value of |-12 + 5|?", v: "üî¢", a: ["7", "-7", "17", "0"], c: "7", exp: "-12 + 5 = -7. The absolute value removes the negative sign." },
        { q: "GCF of 24 and 36?", v: "üî¢", a: ["12", "6", "8", "4"], c: "12", exp: "12 is the largest number that divides into both 24 and 36." },
        { q: "How many mm in 1.5 meters?", v: "üìè", a: ["1500", "150", "15", "15000"], c: "1500", exp: "1 meter = 1000mm. 1.5 * 1000 = 1500." },
        { q: "Convert 5/4 to a percentage.", v: "üî¢", a: ["125%", "80%", "120%", "25%"], c: "125%", exp: "5 / 4 = 1.25. Multiply by 100 to get 125%." },
        { q: "Find the range: 10, 2, 8, 15, 1", v: "üìä", a: ["14", "15", "10", "7"], c: "14", exp: "Range = Max - Min (15 - 1 = 14)." },
        { q: "Solve: 5 squared minus 3 cubed.", v: "üî¢", a: ["-2", "2", "3", "0"], c: "-2", exp: "5¬≤ (25) - 3¬≥ (27) = -2." },
        { q: "Complementary angle to 30¬∞?", v: "üìê", a: ["60¬∞", "150¬∞", "90¬∞", "30¬∞"], c: "60¬∞", exp: "Complementary angles add up to 90¬∞." },
        { q: "Circle diameter is 10. Circumference?", v: "‚≠ï", a: ["31.4", "15.7", "62.8", "100"], c: "31.4", exp: "Formula: œÄ * diameter = 3.14 * 10 = 31.4." },
        { q: "Product of 1.2 and 0.5?", v: "üî¢", a: ["0.6", "6", "0.06", "1.7"], c: "0.6", exp: "12 * 5 = 60. Moving the decimal two places left gives 0.6." },
        { q: "Prime factors of 12?", v: "üî¢", a: ["2, 2, 3", "2, 6", "3, 4", "12, 1"], c: "2, 2, 3", exp: "Prime numbers only: 2 * 2 * 3 = 12." },
        { q: "Solve: 10 - (-5)", v: "‚öñÔ∏è", a: ["15", "5", "-5", "-15"], c: "15", exp: "Subtracting a negative is the same as adding: 10 + 5 = 15." },
        { q: "What is 1/3 of 1/4?", v: "üçï", a: ["1/12", "1/7", "2/7", "3/4"], c: "1/12", exp: "Multiply denominators: 1 * 1 / 3 * 4 = 1/12." },
        { q: "Surface area of cube with side 3?", v: "üì¶", a: ["54", "27", "9", "36"], c: "54", exp: "6 sides * (3 * 3) = 6 * 9 = 54." },
        { q: "If x=2, what is 3x¬≤ + 4?", v: "‚öñÔ∏è", a: ["16", "40", "10", "22"], c: "16", exp: "3 * (2¬≤) + 4 = 3 * 4 + 4 = 16." },
        { q: "Sum of angles in a hexagon?", v: "‚¨°", a: ["720", "540", "360", "1080"], c: "720", exp: "Formula: (n-2)*180 = (6-2)*180 = 720." },
        { q: "Solve for k: 5k - 2 = 13", v: "‚öñÔ∏è", a: ["3", "5", "4", "2"], c: "3", exp: "5k = 15, so k = 3." },
        { q: "A cube has volume 64. Side length?", v: "üì¶", a: ["4", "8", "16", "2"], c: "4", exp: "The cube root of 64 is 4 (4 * 4 * 4 = 64)." },
        { q: "Degrees in half a circle?", v: "üìê", a: ["180", "90", "360", "270"], c: "180", exp: "A full circle is 360¬∞, so half is 180¬∞." },
        { q: "Probability of picking a King?", v: "üÉè", a: ["1/13", "4/13", "1/52", "1/4"], c: "1/13", exp: "There are 4 Kings in 52 cards. 4/52 simplifies to 1/13." },
        { q: "Sum of primes between 1 and 10?", v: "üî¢", a: ["17", "18", "15", "20"], c: "17", exp: "Primes: 2, 3, 5, 7. Sum = 17." }
    ],
    "science": [
        { q: "Smallest unit of an element?", v: "‚öõÔ∏è", a: ["Atom", "Molecule", "Cell", "Tissue"], c: "Atom", exp: "An atom is the base unit of matter that defines an element." },
        { q: "Fixed volume but no fixed shape?", v: "üíß", a: ["Liquid", "Solid", "Gas", "Plasma"], c: "Liquid", exp: "Liquids flow to fit containers but cannot be compressed like gases." },
        { q: "Earth's center layer?", v: "üåç", a: ["Core", "Mantle", "Crust", "Atmosphere"], c: "Core", exp: "The core is the innermost, hottest layer of Earth." },
        { q: "Process plants use to make food?", v: "üåø", a: ["Photosynthesis", "Respiration", "Digestion", "Osmosis"], c: "Photosynthesis", exp: "Plants convert sunlight, water, and CO2 into glucose." },
        { q: "Force that resists motion?", v: "üëû", a: ["Friction", "Gravity", "Magnetism", "Inertia"], c: "Friction", exp: "Friction occurs when two surfaces rub against each other." },
        { q: "Unit of electrical resistance?", v: "‚ö°", a: ["Ohm", "Volt", "Amp", "Watt"], c: "Ohm", exp: "Named after Georg Simon Ohm; it measures opposition to current." },
        { q: "Gas most abundant in our air?", v: "‚òÅÔ∏è", a: ["Nitrogen", "Oxygen", "Carbon Dioxide", "Argon"], c: "Nitrogen", exp: "Nitrogen makes up about 78% of Earth's atmosphere." },
        { q: "Circuit with only one path?", v: "üîå", a: ["Series circuit", "Parallel circuit", "Short circuit", "Open circuit"], c: "Series circuit", exp: "In series, electricity flows through components one after another." },
        { q: "Energy of motion is...", v: "üèÉ", a: ["Kinetic", "Potential", "Thermal", "Chemical"], c: "Kinetic", exp: "Anything that is moving has kinetic energy." },
        { q: "What is the pH of pure water?", v: "üß™", a: ["7", "0", "14", "1"], c: "7", exp: "7 is considered neutral on the pH scale." },
        { q: "Blood cells that carry oxygen?", v: "ü©∏", a: ["Red cells", "White cells", "Platelets", "Plasma"], c: "Red cells", exp: "Hemoglobin in red blood cells binds to oxygen." },
        { q: "Turning from gas to solid?", v: "‚ùÑÔ∏è", a: ["Deposition", "Sublimation", "Freezing", "Melting"], c: "Deposition", exp: "Deposition skips the liquid phase (like frost forming)." },
        { q: "The 'Brain' of the cell?", v: "üß¨", a: ["Nucleus", "Vacuole", "Ribosome", "Wall"], c: "Nucleus", exp: "The nucleus contains genetic material and controls cell activity." },
        { q: "Speed with a direction?", v: "üèéÔ∏è", a: ["Velocity", "Acceleration", "Momentum", "Inertia"], c: "Velocity", exp: "Velocity is a vector quantity (magnitude + direction)." },
        { q: "Rock formed by heat and pressure?", v: "üíé", a: ["Metamorphic", "Igneous", "Sedimentary", "Magma"], c: "Metamorphic", exp: "Metamorphic rocks are 'changed' from other rocks by heat/pressure." },
        { q: "Largest organ of the body?", v: "üë§", a: ["Skin", "Liver", "Lungs", "Brain"], c: "Skin", exp: "The skin covers the entire body and provides protection." },
        { q: "Temperature where all motion stops?", v: "ü•∂", a: ["Absolute Zero", "0¬∞C", "0¬∞F", "Freezing"], c: "Absolute Zero", exp: "At 0 Kelvin, particles have minimal thermal motion." },
        { q: "Measures air pressure?", v: "üå°Ô∏è", a: ["Barometer", "Anemometer", "Thermometer", "Hygrometer"], c: "Barometer", exp: "Barometers track atmospheric pressure for weather forecasting." },
        { q: "Planets that lack solid surfaces?", v: "ü™ê", a: ["Gas Giants", "Terrestrial", "Dwarfs", "Moons"], c: "Gas Giants", exp: "Jupiter, Saturn, Uranus, and Neptune are made mostly of gas." },
        { q: "Human body's master gland?", v: "üß†", a: ["Pituitary", "Thyroid", "Adrenal", "Heart"], c: "Pituitary", exp: "The pituitary gland controls many other endocrine glands." },
        { q: "Speeds up chemical reactions?", v: "üß™", a: ["Catalyst", "Isotope", "Solvent", "Acid"], c: "Catalyst", exp: "Catalysts lower the activation energy required for a reaction." },
        { q: "Moon phase when it is invisible?", v: "üåë", a: ["New Moon", "Full Moon", "Gibbous", "Crescent"], c: "New Moon", exp: "The New Moon occurs when the moon is between Earth and the Sun." },
        { q: "Animal without a backbone?", v: "üêõ", a: ["Invertebrate", "Mammal", "Reptile", "Bird"], c: "Invertebrate", exp: "97% of all animal species are invertebrates (like insects)." },
        { q: "Study of weather?", v: "‚õàÔ∏è", a: ["Meteorology", "Geology", "Biology", "Astronomy"], c: "Meteorology", exp: "Meteorologists study atmospheric conditions." },
        { q: "Pulls objects toward Earth?", v: "üåç", a: ["Gravity", "Tension", "Lift", "Drag"], c: "Gravity", exp: "Gravity is a force of attraction between masses." },
        { q: "Clouds like cotton balls?", v: "‚òÅÔ∏è", a: ["Cumulus", "Stratus", "Cirrus", "Nimbus"], c: "Cumulus", exp: "Cumulus clouds are fluffy and indicate fair weather." },
        { q: "Distance light travels in a year?", v: "‚ú®", a: ["Light Year", "Parsec", "Astronomical Unit", "Mach"], c: "Light Year", exp: "It is a measure of distance, not time (approx. 6 trillion miles)." },
        { q: "Atoms share electrons?", v: "ü§ù", a: ["Covalent", "Ionic", "Metallic", "Hydrogen"], c: "Covalent", exp: "Covalent bonds involve the sharing of electron pairs between atoms." },
        { q: "Earth's orbit shape?", v: "üîÑ", a: ["Elliptical", "Circular", "Square", "Wavy"], c: "Elliptical", exp: "Kepler's First Law states orbits are slightly oval (elliptical)." },
        { q: "First element on Periodic Table?", v: "üéà", a: ["Hydrogen", "Helium", "Lithium", "Oxygen"], c: "Hydrogen", exp: "Hydrogen is the simplest and most abundant element." },
        { q: "Energy stored in a spring?", v: "üåÄ", a: ["Elastic Potential", "Thermal", "Kinetic", "Sound"], c: "Elastic Potential", exp: "Energy stored as a result of deformation is elastic potential." },
        { q: "A push or pull?", v: "üí•", a: ["Force", "Power", "Weight", "Work"], c: "Force", exp: "Newton's Second Law describes Force as Mass * Acceleration." },
        { q: "Plant part that takes in water?", v: "üå±", a: ["Roots", "Leaves", "Stem", "Flower"], c: "Roots", exp: "Roots absorb water and nutrients from the soil via osmosis." },
        { q: "Hottest planet?", v: "üî•", a: ["Venus", "Mercury", "Jupiter", "Mars"], c: "Venus", exp: "Venus has a thick atmosphere that traps heat (Greenhouse effect)." },
        { q: "Measure of the pull of gravity?", v: "‚öñÔ∏è", a: ["Weight", "Density", "Volume", "Height"], c: "Weight", exp: "Weight changes based on gravity; mass stays the same." }
    ],
    "social": [
        { q: "Who was 'Father of the Constitution'?", v: "üìú", a: ["James Madison", "Washington", "Jefferson", "Hamilton"], c: "James Madison" },
        { q: "Year the US Civil War began?", v: "‚öîÔ∏è", a: ["1861", "1776", "1812", "1914"], c: "1861" },
        { q: "First 10 Amendments?", v: "üìú", a: ["Bill of Rights", "Preamble", "Articles", "Federalist"], c: "Bill of Rights" },
        { q: "Ancient system of writing in Egypt?", v: "üìê", a: ["Hieroglyphics", "Cuneiform", "Latin", "Sanskrit"], c: "Hieroglyphics" },
        { q: "Smallest country in the world?", v: "üáªüá¶", a: ["Vatican City", "Monaco", "Iceland", "Malta"], c: "Vatican City" },
        { q: "Main author of the Declaration?", v: "‚úçÔ∏è", a: ["Jefferson", "Franklin", "Adams", "Lincoln"], c: "Jefferson" },
        { q: "Empire that built the Colosseum?", v: "üèõÔ∏è", a: ["Roman", "Greek", "Ottoman", "Persian"], c: "Roman" },
        { q: "Capital of China?", v: "üá®üá≥", a: ["Beijing", "Shanghai", "Tokyo", "Seoul"], c: "Beijing" },
        { q: "War between US and Britain (1800s)?", v: "üö¢", a: ["War of 1812", "Revolution", "WW1", "Civil War"], c: "War of 1812" },
        { q: "Line at 0¬∞ Longitude?", v: "üåç", a: ["Prime Meridian", "Equator", "Tropic", "Dateline"], c: "Prime Meridian" },
        { q: "Gave 'Gettysburg Address'?", v: "üé©", a: ["Lincoln", "Kennedy", "Roosevelt", "Obama"], c: "Lincoln" },
        { q: "Largest cold desert?", v: "üèúÔ∏è", a: ["Antarctic", "Sahara", "Gobi", "Atacama"], c: "Antarctic" },
        { q: "Who 'discovered' Americas in 1492?", v: "‚õµ", a: ["Columbus", "Magellan", "Cook", "Vespucci"], c: "Columbus" },
        { q: "Private ownership economy?", v: "üí∞", a: ["Capitalism", "Communism", "Socialism", "Bartering"], c: "Capitalism" },
        { q: "First to sign the Declaration?", v: "‚úçÔ∏è", a: ["John Hancock", "Sam Adams", "Ben Franklin", "Washington"], c: "John Hancock" },
        { q: "Andes Mountain civilization?", v: "üèîÔ∏è", a: ["Inca", "Aztec", "Maya", "Olmec"], c: "Inca" },
        { q: "Ocean on US East Coast?", v: "üåä", a: ["Atlantic", "Pacific", "Indian", "Arctic"], c: "Atlantic" },
        { q: "Leader with a 'Dream'?", v: "üéôÔ∏è", a: ["MLK Jr.", "Malcolm X", "John Lewis", "Thurgood"], c: "MLK Jr." },
        { q: "Number of Amendments today?", v: "üìú", a: ["27", "10", "50", "13"], c: "27" },
        { q: "Gifted the Statue of Liberty?", v: "üóΩ", a: ["France", "England", "Germany", "Canada"], c: "France" },
        { q: "Where Industrial Revolution began?", v: "‚öôÔ∏è", a: ["Great Britain", "USA", "France", "Japan"], c: "Great Britain" },
        { q: "Longest river in the world?", v: "üõ∂", a: ["Nile", "Amazon", "Mississippi", "Yangtze"], c: "Nile" },
        { q: "Amendment for women's voting?", v: "üó≥Ô∏è", a: ["19th", "1st", "13th", "21st"], c: "19th" },
        { q: "Rebirth period after Middle Ages?", v: "üé®", a: ["Renaissance", "Enlightenment", "Victorian", "Dark Ages"], c: "Renaissance" },
        { q: "Forced Native American move?", v: "üë£", a: ["Trail of Tears", "Oregon Trail", "Santa Fe", "Silk Road"], c: "Trail of Tears" },
        { q: "President during Great Depression?", v: "üìâ", a: ["FDR", "Hoover", "Truman", "Wilson"], c: "FDR" },
        { q: "River through Egypt?", v: "üá™üá¨", a: ["Nile", "Congo", "Jordan", "Euphrates"], c: "Nile" },
        { q: "Won Space Race to the moon?", v: "üöÄ", a: ["USA", "USSR", "China", "Germany"], c: "USA" },
        { q: "System where people vote?", v: "‚öñÔ∏è", a: ["Republic", "Monarchy", "Dictatorship", "Theocracy"], c: "Republic" },
        { q: "Trigger for World War I?", v: "üî´", a: ["Assassination", "Pearl Harbor", "D-Day", "Atomic Bomb"], c: "Assassination" },
        { q: "Liberty Bell location?", v: "üîî", a: ["Philadelphia", "DC", "Boston", "NYC"], c: "Philadelphia" },
        { q: "Wrote 'Common Sense'?", v: "‚úçÔ∏è", a: ["Thomas Paine", "Franklin", "Jefferson", "Adams"], c: "Thomas Paine" },
        { q: "Highest population today?", v: "üåç", a: ["India", "China", "USA", "Russia"], c: "India" },
        { q: "Main axis power in WW2?", v: "‚öîÔ∏è", a: ["Germany", "England", "Russia", "USA"], c: "Germany" },
        { q: "Branch that makes laws?", v: "‚öñÔ∏è", a: ["Legislative", "Executive", "Judicial", "State"], c: "Legislative" }
    ],
    "ela": [
        // MCQs (17)
        { q: "Synonym for 'Meticulous'?", a: ["Careful", "Messy", "Fast", "Angry"], c: "Careful" },
        { q: "Meaning of 'Exhilarating'?", a: ["Thrilling", "Boring", "Tiring", "Scary"], c: "Thrilling" },
        { q: "Antonym for 'Fragile'?", a: ["Sturdy", "Weak", "Broken", "Small"], c: "Sturdy" },
        { q: "Identify the Onomatopoeia:", a: ["Sizzle", "Bright", "Quickly", "Walked"], c: "Sizzle" },
        { q: "Main character is the...", a: ["Protagonist", "Antagonist", "Narrator", "Dynamic"], c: "Protagonist" },
        { q: "A 'Hyperbole' is a huge...", a: ["Exaggeration", "Comparison", "Understatement", "Lie"], c: "Exaggeration" },
        { q: "Which is a 'Proper Noun'?", a: ["Tokyo", "City", "Mountain", "River"], c: "Tokyo" },
        { q: "Identify the Adjective: 'The silent room.'", a: ["Silent", "The", "Room", "Is"], c: "Silent" },
        { q: "Past tense of 'Catch'?", a: ["Caught", "Catched", "Catching", "Catchs"], c: "Caught" },
        { q: "A group of lines in a poem?", a: ["Stanza", "Paragraph", "Chapter", "Verse"], c: "Stanza" },
        { q: "Meaning of the prefix 'Bio-'?", a: ["Life", "Earth", "Small", "Against"], c: "Life" },
        { q: "Opposite of 'Chaos'?", a: ["Order", "Mess", "Noise", "Wild"], c: "Order" },
        { q: "Identify the conjunction:", a: ["Because", "Jump", "Yellow", "He"], c: "Because" },
        { q: "Meaning of the suffix '-less'?", a: ["Without", "Full of", "Able to", "Most"], c: "Without" },
        { q: "Identify the pronoun: 'We will win.'", a: ["We", "Will", "Win", "Them"], c: "We" },
        { q: "Synonym for 'Lethargic'?", a: ["Tired", "Excited", "Fast", "Angry"], c: "Tired" },
        { q: "Which word is misspelled?", a: ["Recieve", "Believe", "Achieve", "Deceive"], c: "Recieve" },
        // FITB (5)
        { q: "Complete the sentence: 'She _____ to the store yesterday.'", type: "typed", c: "went" },
        { q: "Fill in the blank: 'The prefix _____ means 'before'.'", type: "typed", c: "pre" },
        { q: "A comparison using 'like' or 'as' is a _____.", type: "typed", c: "simile" },
        { q: "The opposite of 'strong' is _____.", type: "typed", c: "weak" },
        { q: "A person who writes a book is an _____.", type: "typed", c: "author" },
        // Passages (8)
        { ctx: "The old library was a labyrinth of oak shelves.", q: "The word 'labyrinth' suggests the library is...", a: ["Complex", "Small", "Modern", "Empty"], c: "Complex" },
        { ctx: "The rain drummed against the glass like tiny fingers.", q: "What is the mood?", a: ["Gloomy", "Exciting", "Joyful", "Scary"], c: "Gloomy" },
        { ctx: "Over 97% of Earth's water is salty.", q: "What percentage is NOT in oceans?", a: ["3%", "97%", "50%", "10%"], c: "3%" },
        { ctx: "The lighthouse stood as a silent sentinel.", q: "Explain the 'silent sentinel' metaphor.", type: "typed", c: "MR" },
        { ctx: "Many believe uniforms improve focus.", q: "What is the main conflict?", a: ["Uniforms vs Expression", "Focus vs Grades", "Teachers vs Students", "Price vs Quality"], c: "Uniforms vs Expression" },
        { ctx: "To be, or not to be...", q: "Identify the internal conflict.", type: "typed", c: "MR" },
        { ctx: "Peaks touching the clouds like frosting.", q: "Identify the simile.", a: ["Like white frosting", "Peaks touching", "Stood tall", "White clouds"], c: "Like white frosting" },
        { ctx: "The map was upside down.", q: "How does this detail contribute to the tone?", type: "typed", c: "MR" },
        // Essays (5)
        { q: "Why is reading important? (4-5 sentences)", type: "typed", c: "MR" },
        { q: "Describe a challenge you faced.", type: "typed", c: "MR" },
        { q: "Argue for/against classroom tech.", type: "typed", c: "MR" },
        { q: "Difference between 'Theme' and 'Plot'.", type: "typed", c: "MR" },
        { q: "Describe your favorite character.", type: "typed", c: "MR" }
    ]
};

let gameDeck = [];
let gameState = { sub: "", idx: 0, rit: 215, streak: 0, gradeIdx: 0, correct: 0 };
const grades = ["GRADE 6", "GRADE 7", "GRADE 8"];

function startTest(subject) {
    gameState = { sub: subject, idx: 0, rit: 215, streak: 0, gradeIdx: 0, correct: 0 };
    gameDeck = [...allData[subject]].sort(() => Math.random() - 0.5);
    document.getElementById('home').classList.add('hidden');
    document.getElementById('quiz').classList.remove('hidden');
    document.getElementById('progress-fill').style.background = `var(--${subject})`;
    renderQuestion();
}

function renderQuestion() {
    if (gameState.idx >= 30 || gameDeck.length === 0) return finishTest();

    document.getElementById('feedback-area').classList.add('hidden');
    const inputArea = document.getElementById('input-area');
    inputArea.classList.remove('hidden');
    inputArea.innerHTML = "";

    if (gameState.streak >= 3) {
        gameState.streak = 0;
        if (gameState.gradeIdx < 2) gameState.gradeIdx++;
    }

    const currentQ = gameDeck.shift(); 
    
    const passageCont = document.getElementById('passage-container');
    const visualArea = document.getElementById('visual-area');
    if(currentQ.ctx) { passageCont.innerText = currentQ.ctx; passageCont.classList.remove('hidden'); }
    else { passageCont.classList.add('hidden'); }

    if(currentQ.v && gameState.sub !== 'ela') { visualArea.innerText = currentQ.v; visualArea.classList.remove('hidden'); }
    else { visualArea.classList.add('hidden'); }

    document.getElementById('q-count').innerText = `ITEM ${gameState.idx + 1} / 30`;
    document.getElementById('grade-level').innerText = grades[gameState.gradeIdx];
    document.getElementById('progress-fill').style.width = `${(gameState.idx / 30) * 100}%`;
    document.getElementById('q-text').innerText = currentQ.q;

    if (currentQ.type === "typed") {
        const ta = document.createElement('textarea');
        ta.placeholder = "Type your response here...";
        const b = document.createElement('button');
        b.className = "btn sub-btn";
        b.style.background = `var(--${gameState.sub})`;
        b.innerText = "Submit Response";
        b.onclick = () => showFeedback(ta.value.toLowerCase().trim(), currentQ);
        inputArea.appendChild(ta);
        inputArea.appendChild(b);
    } else {
        [...currentQ.a].sort(() => Math.random() - 0.5).forEach(opt => {
            let b = document.createElement('button');
            b.className = "btn";
            b.innerText = opt;
            b.onclick = () => showFeedback(opt, currentQ);
            inputArea.appendChild(b);
        });
    }
}

function showFeedback(userAns, qObj) {
    const inputArea = document.getElementById('input-area');
    const fbArea = document.getElementById('feedback-area');
    const fbMsg = document.getElementById('feedback-msg');
    const nextBtn = document.getElementById('next-btn');

    inputArea.classList.add('hidden');
    fbArea.classList.remove('hidden');

    let isCorrect = false;
    if(qObj.c === "MR") {
        isCorrect = userAns.length > 3;
        fbMsg.className = "correct-fb";
        fbMsg.innerHTML = "‚úì Response Captured! <br> Record saved for adaptive scoring.";
    } else if(userAns === qObj.c.toLowerCase() || userAns === qObj.c) {
        isCorrect = true;
        fbMsg.className = "correct-fb";
        fbMsg.innerHTML = "‚úì Correct! Great job.";
    } else {
        isCorrect = false;
        fbMsg.className = "wrong-fb";
        let feedbackHTML = `‚úó Incorrect. <br> The correct answer was: <strong>${qObj.c}</strong>`;
        
        // Add STEM Explanation if applicable
        if((gameState.sub === 'math' || gameState.sub === 'science') && qObj.exp) {
            feedbackHTML += `<div class="explanation-text"><strong>Explanation:</strong> ${qObj.exp}</div>`;
        }
        fbMsg.innerHTML = feedbackHTML;
    }

    if(isCorrect) {
        gameState.rit += 4; gameState.streak++; gameState.correct++;
    } else {
        if (gameState.streak === 0 && gameState.gradeIdx > 0) gameState.gradeIdx--;
        gameState.rit = Math.max(160, gameState.rit - 3); 
        gameState.streak = 0;
    }

    nextBtn.onclick = () => {
        gameState.idx++;
        renderQuestion();
    };
}

function finishTest() {
    document.getElementById('quiz').classList.add('hidden');
    document.getElementById('results').classList.remove('hidden');
    document.getElementById('final-rit').innerText = gameState.rit;
    document.getElementById('accuracy').innerText = `Assessment Complete: ${gameState.correct} / 30`;
}
</script>
</body>
</html>